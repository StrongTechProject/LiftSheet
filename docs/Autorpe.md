# Autorpe.js 脚本说明文档

## 1. 概述
`Autorpe.js` 是一个 Google Apps Script 脚本，主要用于自动化处理健身训练记录表中的 RPE (Rate of Perceived Exertion) 相关数据。该脚本通过监听表格的 `onEdit` 事件触发，当用户在特定列选择特定的评估值（如 "Optimal", "Hard[+1]" 等）时，自动根据预设逻辑更新当前行及下一行的相关单元格数据。

## 2. 触发机制 (Trigger Mechanism)

### 2.1 监听范围
脚本仅在修改以下特定列时触发：
*   **J 列** (第 10 列)
*   **X 列** (第 24 列)
*   **AL 列** (第 38 列)
*   **AZ 列** (第 52 列)

### 2.2 有效触发值 (Trigger Values)
只有当单元格被修改为以下特定文本时，才会执行后续逻辑。每种文本对应一个数值修饰符 (Modifier)：

| 触发文本 (Input Text) | 修饰符值 (Modifier) |
| :--- | :--- |
| `Optimal` | 0 |
| `Easy[-1]` | -1 |
| `Comfortable[-0.5]` | -0.5 |
| `Challenging[+0.5]` | 0.5 |
| `Hard[+1]` | 1 |

> **注意**：脚本会优先读取事件对象 `e.value`，如果为空（例如移动端操作或粘贴），则会主动读取单元格的值。为了性能考虑，批量粘贴操作（多行/多列）会被忽略。

## 3. 列映射逻辑 (Column Mappings)

脚本根据触发列的不同，动态确定数据源列的位置。

| 触发列 (Trigger Col) | 源数据列 (Source) | 左侧数据源列 (Left Source) | 下一行数据源列 (Next Row Source) |
| :--- | :--- | :--- | :--- |
| **J (10)** | F (6) | E (5) | G (7) |
| **X (24)** | T (20) | S (19) | U (21) |
| **AL (38)** | AH (34) | AG (33) | AI (35) |
| **AZ (52)** | AV (48) | AU (47) | AW (49) |

## 4. 执行流程 (Execution Steps)

当满足触发条件时，脚本将按顺序执行以下 **5 个步骤**：

1.  **获取源数据**：
    *   根据映射关系，读取对应“源数据列”当前行的值（例如触发列为 J 时，读取 F 列的值）。
    *   *安全检查*：如果源数据不是数字，操作将中止。

2.  **更新触发单元格**：
    *   计算新值：`新值 = 源数据值 + 修饰符`。
    *   将触发单元格（例如 J11）的值更新为这个计算出的新值。
    *   *目的*：将用户选择的文本评估（如 "Hard[+1]"）替换为实际计算后的数值。

3.  **同步左侧单元格**：
    *   读取“左侧数据源列”当前行的值（例如 E11）。
    *   将触发列左侧一格（例如 I11）更新为该值。

4.  **标记下一行状态**：
    *   将下一行、左侧两格的位置（例如 H12）临时标记为文本 `"Processing"`。
    *   *目的*：给用户一个视觉反馈，表明数据正在处理中。

5.  **更新下一行数据（带延迟）**：
    *   脚本暂停 1 秒 (`Utilities.sleep(1000)`)。
    *   读取“下一行数据源列”下一行的值（例如 G12）。
    *   将步骤 4 中的单元格（例如 H12）更新为该读取到的值。

## 5. 代码维护指南

*   **修改触发列**：若需增加或修改监听的列，请更新 `onEdit` 函数中的 `triggerColumns` 数组以及 `executeModifications` 函数中的 `colMappings` 对象。
*   **修改触发词**：若需调整评估词或对应的数值，请修改 `onEdit` 函数中的 `triggerValues` 对象。
*   **调整逻辑**：核心修改逻辑位于 `executeModifications` 函数中。

---
*文档更新日期：2025-12-14*
